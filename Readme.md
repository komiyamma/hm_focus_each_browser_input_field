# HmFocusEachBrowserInputField

秀丸エディタでの使用を想定した、WebView2コントロール内の入力フィールドにフォーカスを当て、さらにテキストを挿入するためのコマンドラインユーティリティです。

## 概要

このツールは、秀丸エディタのマクロから呼び出されることを想定したヘルパーアプリケーションです。秀丸エディタがHTMLプレビューなどの機能で埋め込みのWebView2（Edge）ブラウザを使用する際に、このユーティリティは利用可能な最初のHTMLの`<input>`または`<textarea>`フィールドにプログラムでキーボードフォーカスを設定することができます。

さらに、ファイルパスを引数として渡すことで、そのファイルの内容を入力フィールドに自動的に挿入し、処理の完了を元のファイルに書き込んで通知する機能も持ちます。

これにより、ユーザーがプレビューペインのフォームフィールドに手動でクリックすることなく、すぐにタイピングを開始したり、テキストを自動入力したりできる、より高度な連携が実現します。

## 使い方

コマンドラインから実行可能ファイルを実行します。引数の構成は以下の通りです。

```shell
HmFocusEachBrowserInputField.exe <hidemaru_window_handle> <dummy_arg> [temp_file_path]
```

### 引数

-   `<hidemaru_window_handle>` (必須): 親となる秀丸エディタのメインウィンドウハンドルの整数値。
-   `<dummy_arg>` (必須、現在未使用): この引数は現在プログラム内で使用されていませんが、将来の拡張のために予約されています。呼び出し時には何らかの値（例: `0`）を指定する必要があります。
-   `[temp_file_path]` (オプション): テキストの入出力に使用する一時ファイルへのフルパス。
    -   この引数が指定されると、プログラムは以下の動作をします。
        1.  指定されたファイルからテキストを読み込みます。
        2.  見つかった入力フィールドにそのテキストを挿入します。
        3.  処理完了後、元のファイルを上書きして完了ステータスを書き込みます（例: `HmConvAiWeb.Complete(2);`）。
    -   この引数が省略された場合、プログラムは入力フィールドにフォーカスを当てるだけです。

プログラムは成功時に`1`または`2`、失敗時に`0`の終了コードを返します。

### 秀丸マクロの例

```javascript

const eachBrowserWindowHandle = 0; // 今はJavaScript側からは取得できない。
const command = `"${currentMacroDirectory}\\HmFocusEachBrowserInputField.exe" ${hidemaru.getCurrentWindowHandle()} ${eachBrowserWindowHandle} "${tempFileFullPath}"`;
processInfoFocus = hidemaru.runProcess(command, ".", "stdio", "utf8");

```

## 動作の仕組み

このアプリケーションは、.NETの**UI Automation**フレームワークを使用して、対象アプリケーションのUI要素を検査します。

1.  提供された秀丸エディタのウィンドウハンドルを受け取ります。
2.  UIツリーを探索し、埋め込まれたWebView2ブラウザコントロール（ウィンドウクラス`HM32EachBrowserCtrl`および`Chrome_WidgetWin_0`で識別）を見つけます。
3.  ブラウザコントロールが見つかると、そのコンテンツ内からフォーカス可能な最初の`Edit`コントロール（HTMLの入力フィールドに対応）を検索します。
4.  フィールドが見つかると、それにキーボードフォーカスを設定します。
5.  **（オプション）** 3番目の引数でファイルパスが指定されている場合、そのファイルの内容を読み込んで入力フィールドに設定し、処理完了後に同ファイルを上書きしてステータスを通知します。

## ビルド方法

このプロジェクトはC#のソリューションです。ビルドするには：

1.  Visual Studioで`HmFocusEachBrowserInputField.sln`を開きます。
2.  ビルド構成として`Release`を選択します。
3.  ソリューションをビルドします（F6キーまたはビルド > ソリューションのビルド）。
4.  実行可能ファイルは`HmFocusEachBrowserInputField/bin/Release/`に生成されます。

## ライセンス

このプロジェクトはMITライセンスの下でライセンスされています。詳細は[LICENSE](LICENSE)ファイルをご覧ください。
